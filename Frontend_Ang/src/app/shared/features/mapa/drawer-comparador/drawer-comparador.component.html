<app-drawer-shell
  [opened]="opened"
  (openedChange)="onOpenedChange($event)"
  [title]="'‚öñÔ∏è Comparador de zonas'"
  position="right"
  [width]="'620px'"
  [loading]="loading"
>
  <div drawer-content>
    <div class="selectors">
      <div class="group">
        <label>Zona A</label>
        <select [(ngModel)]="zonaA">
          <option [ngValue]="null">Selecciona...</option>
          <option *ngFor="let z of zonasConDatos" [value]="z">{{ z }}</option>
        </select>
      </div>

      <div class="group">
        <label>Zona B</label>
        <select [(ngModel)]="zonaB">
          <option [ngValue]="null">Selecciona...</option>
          <option *ngFor="let z of zonasConDatos" [value]="z">{{ z }}</option>
        </select>
      </div>
    </div>

    <div class="operation-toggle">
      <label>Tipo de operaci√≥n:</label>
      <select [(ngModel)]="tipoOperacion" (change)="actualizarZonas()">
        <option value="sale">üè† Venta</option>
        <option value="rent">üîë Alquiler</option>
      </select>
    </div>

    <div *ngIf="zonaA && zonaB" class="comparacion">
      <p class="summary">
        Comparando <strong>{{ zonaA }}</strong> vs <strong>{{ zonaB }}</strong>
        ({{ tipoOperacion === 'sale' ? 'Venta' : 'Alquiler' }})
      </p>

      <!-- Gr√°ficos -->
      <div class="chart-group">
        <div class="chart-item">
          <h4>üí∂ Precio medio (‚Ç¨)</h4>
          <canvas baseChart [data]="crearDatosChart('precio_medio')" chartType="bar"></canvas>
        </div>

        <div class="chart-item">
          <h4>üìè Tama√±o medio (m¬≤)</h4>
          <canvas baseChart [data]="crearDatosChart('tamano_medio')" chartType="bar"></canvas>
        </div>

        <div class="chart-item">
          <h4>‚≠ê Score medio</h4>
          <canvas baseChart [data]="crearDatosChart('score_medio')" chartType="bar"></canvas>
        </div>

        <div class="chart-item">
          <h4>üèòÔ∏è N√∫mero de pisos</h4>
          <canvas baseChart [data]="crearDatosChart('count')" chartType="bar"></canvas>
        </div>
      </div>

      <!-- Tabla resumen -->
      <table class="comparador-tabla">
        <thead>
          <tr>
            <th>M√©trica</th>
            <th>{{ zonaA }}</th>
            <th>{{ zonaB }}</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Precio medio (‚Ç¨)</td>
            <td>{{ getDatosZona(zonaA)?.precio_medio?.toLocaleString?.() ?? '‚Äî' }}</td>
            <td>{{ getDatosZona(zonaB)?.precio_medio?.toLocaleString?.() ?? '‚Äî' }}</td>
          </tr>
          <tr>
            <td>Tama√±o medio (m¬≤)</td>
            <td>{{ getDatosZona(zonaA)?.tamano_medio?.toFixed?.(1) ?? '‚Äî' }}</td>
            <td>{{ getDatosZona(zonaB)?.tamano_medio?.toFixed?.(1) ?? '‚Äî' }}</td>
          </tr>
          <tr>
            <td>Score medio</td>
            <td>{{ getDatosZona(zonaA)?.score_medio?.toFixed?.(1) ?? '‚Äî' }}</td>
            <td>{{ getDatosZona(zonaB)?.score_medio?.toFixed?.(1) ?? '‚Äî' }}</td>
          </tr>
          <tr>
            <td>N¬∫ de pisos</td>
            <td>{{ getDatosZona(zonaA)?.count ?? '‚Äî' }}</td>
            <td>{{ getDatosZona(zonaB)?.count ?? '‚Äî' }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <p *ngIf="!zonaA || !zonaB" class="empty-msg">
      Selecciona dos zonas para comparar.
    </p>
  </div>
</app-drawer-shell>
